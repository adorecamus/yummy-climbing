<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yummyclimbing.mapper.party.PartyMemberMapper">

	<!-- 소소모임 부원 가입 -->
	<insert id="insertPartyMember" parameterType="com.yummyclimbing.vo.party.PartyMemberVO">
		INSERT INTO PARTY_MEMBER(
		PI_NUM, UI_NUM, PM_GRADE
		) VALUES(
		#{piNum}, #{uiNum}, #{pmGrade})
	</insert>
	
	<!-- 소소모임 부원 탈퇴 -->
	<update id="quitPartyMember">
		UPDATE PARTY_MEMBER
		SET PM_ACTIVE = 0
		WHERE UI_NUM = #{uiNum} AND PI_NUM=#{piNum}
	</update>
	
	<!-- 회원의 소소모임 리스트 조회 -->
	<select id="selectPiNumAndGradeByUiNum" resultType="com.yummyclimbing.vo.party.PartyMemberVO">
		SELECT PI_NUM, PM_GRADE
		FROM PARTY_MEMBER PM
		INNER JOIN USER_INFO UI ON PM_ACTIVE = 1 AND PM.UI_NUM = UI.UI_NUM
		WHERE PM.UI_NUM = #{uiNum}
	</select>
	
	<!-- 소소모임에 이미 가입된 부원인지 확인 -->
	<select id="checkJoinedParty" resultType = "com.yummyclimbing.vo.party.PartyMemberVO">
		SELECT PM_ACTIVE, PI_NUM, UI_NUM
		FROM PARTY_MEMBER	 
		WHERE PI_NUM= #{piNum} AND UI_NUM = #{uiNum}
	</select>
	
	<!-- 소소모임 재가입 -->
	<update id="rejoinParty" parameterType="com.yummyclimbing.vo.party.PartyMemberVO">
		UPDATE PARTY_MEMBER
		SET PM_ACTIVE = 1
		WHERE UI_NUM = #{uiNum} AND PI_NUM=#{piNum}		
	</update>
</mapper>